<html>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

    <style>
        body,h1,h5 {font-family: "Raleway", sans-serif}
        body, html {height: 100%}
        .bgimg {
            background-image: url('image/restaurantcityIMAGE.jpg');
            min-height: 100%;
            background-position: center;
            background-size: cover;
        }
    </style>

    <head>
        <!-- jquery google CDN -->
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
    </head>

    <body>  
        <div class="bgimg w3-display-container w3-text-black">
        <div class="w3-display-right w3-container w3-xlarge">
            <p>
            <form id='loginForm' action='login' method='POST'>
                <table> 
                    <tr>
                        <td><b>UserID:</b></td><td><input id='userID' type='text' name='userID'></td><td id='userIdError'></td>
                    </tr>
                    <tr>
                        <td><b>Password:</b></td><td><input id='password' type='password' name='pwd'></td><td id='pwdError'></td>
                    </tr>
                </table>
                <input type='submit' name='submitBtn'><div id='error'></div>
            </form>
            </p>
        </div>
        <div class="w3-display-bottomright w3-container">
            <p class="w3-xlarge">monday - friday 0800-1730 | saturday 0800-1230</p>
            <p class="w3-large">123 Singapore Management Univeristy 312657</p>
        </div>
        </div>
    </body>

    <script>

        $("#loginForm").submit(async (event) => {
            //Prevents screen from refreshing when submitting
            
            event.preventDefault();
            var noErrorMsg= true;
            if ($('#userID').val().length === 0){
                $('#userIdError').text('Please enter User ID')
                noErrorMsg=false;
            }else{
                $('#userIdError').text('')
                var userID = $('#userID').val();
            }
            if ($('#password').val().length === 0){
                $('#pwdError').text('Please enter Password')
                noErrorMsg=false
            }else{
                $('#pwdError').text('')
                var pwd = $('#password').val();
            }
            if (noErrorMsg){
                var serviceURL = "http://127.0.0.1:5001/user";
                try {
                    const response =
                    await fetch(
                    serviceURL, { method: 'POST',headers: {
                        'Content-Type': 'application/json'
                        }, body:  JSON.stringify({userId :userID ,password:pwd}) 
                    });
                    const data = await response.json();
                    if (!response.ok){
                        $('#error').text(data.message);
                    }else{
                        $("#loginForm").unbind('submit').submit();
                    }
                    
                } catch (error) {
                        // Errors when calling the service; such as network error, 
                        // service offline, etc
                        // showError
                        $('#error').text('Server Error, please try again later.<br />'+error);
                    
                } 
            }

        })
    </script>
</html>