<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <h1><center>Driver page</center></h1>
        <!-- <link rel="stylesheet" href="style.css"> -->
        <!-- <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">    -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>
    <body>
        <div id="main-container" class="container"> 
        <table id='driverTable' border='1'>    
            <div class="table">         
                <tr>
                    <th>driverId</th><th>orderId</th><th>customer_name</th><th>contactNo</th><th>billingAddress</th>  
                </tr>
            </div>
        </table>
        <form id="driverForm" method="GET">
            <h4>Driver ID</h4>
            <div class="text">
              <input name="driver" type="text" id="driver" placeholder="Enter your Driver ID." required/>
            </div>
            <div class = "submit">
            <input type="submit" value="Submit">
            </div>
        </form>
        </div>
        <input type="button" id='return' name='return' value='Return'/>

    </body>

<script>
        $(document).ready(function() {
            $('#driverTable').hide();
            $('#return').hide();
        });
        function showError(message) {
            // Hide the table and button in the event of error
            $('#driverTable').hide();
            // Display an error under the main container
            $('#main-container')
                .append("<label>"+message+"</label>");
        }
        $("#driverForm").submit(async (event) => {        
                // Change serviceURL to your own
                event.preventDefault();
                $('#driverTable').show();
                $('#driverForm').hide();
                $('#return').show();
                var driverId = $('#driver').val();
                var serviceURL = "http://127.0.0.1:5002/driver/" + driverId;
                // console.log(serviceURL)
                // console.log(driverId)
            
                try {
                    const response = 
                     await fetch(
                       serviceURL, { method: 'GET' }
                    );
                    const data = await response.json();
                    // console.log(data)
                    var driver = data.driverId; //the arr is in data.driver of the JSON data
                    // console.log(driver)
                    // array or array.length are falsy
                    if (!driver || !driverId.length) {
                        showError('Driver list empty or undefined.')
                    } else {
                        // for loop to setup all table rows with obtained book data
                        var rows = "";
                        eachRow =
                                "<td align='center'>" + data.driverId + "</td>" +
                                "<td align='center'>" + data.orderId+ "</td>" +
                                "<td align='center'>" + data.customer_name + "</td>" +
                                "<td align='center'>" + data.contactNo + "</td>"+
                                "<td align='center'>" + data.billingAddress + "</td>";
                            rows += "<tr>" + eachRow + "</tr>";
                        // add all the rows to the table
                        $('#driverTable').append(rows);
                    }
                } catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                    showError
                    ('There is a problem retrieving driver data, please try again later.<br />'+error);
               
            } // error
        });

        $( "#return" ).click(function() {
            location.reload(true);
        });

        </script>